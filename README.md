# Objectstore

Objectstore is a database for storing Objects that can be related to each other.

You can use Objectstore either as a library in your own app, or run it as a REST server. Methods are exposed to allow you to control the server programatically, and a script to run it out of the box.

Objectstore uses Postgresql as it's backing database.

## Concept

Objectstore has Objects and Relationships

Objects have an id (a uuid generated by Objectstore), a type, and a slug.

Data for the objects is arbitrary JSON.

You can create (add) an object and update (set) it's JSON. The id and type are immutable.

You can create relationships between objects. The relationships have an optional role, expiration and position.

Some uses of relationships are

* parent-child, i.e a collection (use position for ordering)
* access control (use role for type of access)
* group membership with expiration

You can find objects based on their type, relationships, and other parameters.

Use slugs to find named object, without using their id (e.g. looking up a user by username, looking up an item in a collection based on a url fragment)


## Quickstart

### Server

Clone the repo


### Node Module

npm install objectstore

var os = requre('objectstore');


## API


### add

```javascript
var obj = {
  slug: 'my-slug',
  attrs: {}
}

add(obj, next)

add(obj, rel, next)

add(obj, rels, next)
```

### set

```javascript
set(id, attrs, next)

### get

### find

```javascript
find(opts, next)
```

Find objects by their type and relationships

`type`
type of objects to find

`id`
id of object they are related to

`role`
role they are related with. Either a string literal or array of
strings. the relationship must be one of the elements of the array

`role_id`
object role_id must have a relationship (if role is
set, the relationship must be of the given role) with id. If that
relationship exists, then objects of type that are related to id
(irrespective of role) are found.

Find is limited to a maximum of 100 returned items

`base` and `limit` parameters can be used in conjunction with `#count` to
effect paging.

### count

Returns number of objects found using same query parameters as find.

### rel

```javascript
rel(id, rel_id [, opts], next)
```
Creates a relationship between two objects

opts and all it's parameters are optional

```json
{
  role: 'some-role',
  position: <integer>,
  expires: <date>
}
```

## Rest API


query

{
 count:x
 objects: [x, x, x]
}


find :id :type (find types related to id) [:role]

get :id

set (no id = create, obj returned)
set :id (obj returned)

del :id




rel :id :rel_id [:role :position: :expires]

relate two objects


## Some Use cases

Users and groups

* create a user
* create a group
* add user to group
* give user role in group
find all users with role

create some items
grant access to some of the items to the group 
find items user x (having role y) can access

does user x have role y on item z


does user have 


create a collection
add an item
get all items
find item by slug


create some items
find items


